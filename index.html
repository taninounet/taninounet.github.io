<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Football Subreddits</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="navbar">
        <a href="#" onclick="loadSubreddit('fantasypl')">HOME</a>
        <a href="#" onclick="loadSubreddit('coys')">Spurs</a>
        <a href="#" onclick="loadSubreddit('reddevils')">ManUtd</a>
        <a href="#" onclick="loadSubreddit('mcfc')">ManCity</a>
        <a href="#" onclick="loadSubreddit('liverpoolfc')">Liverpool</a>
        <a href="#" onclick="loadSubreddit('chelseafc')">Chelsea</a>
        <a href="#" onclick="loadSubreddit('crystalpalace')">Palace</a>
        <a href="#" onclick="loadSubreddit('wwfc')">Wolves</a>
    </div>

    <div id="content">
        <h2>Select a subreddit to see the latest posts</h2>
    </div>

    <button id="load-more" style="display: none;" onclick="loadMorePosts()">Load More</button>

    <div id="comments-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCommentsModal()">&times;</span>
            <div id="comments-container" class="comments-container"></div>
        </div>
    </div>

    <script>
        let after = null;
        let currentSubreddit = '';

        async function loadSubreddit(subreddit, reset = true) {
            currentSubreddit = subreddit;
            if (reset) {
                after = null;
                document.getElementById('content').innerHTML = '';
            }
            const response = await fetch(`https://www.reddit.com/r/${subreddit}/new.json?limit=10&after=${after}`);
            const data = await response.json();
            after = data.data.after;
            const posts = data.data.children;

            let contentDiv = document.getElementById('content');
            contentDiv.innerHTML += `<h2>Latest Posts from r/${subreddit}</h2>`;
            
            posts.forEach(post => {
                const postData = post.data;
                const postElement = document.createElement('div');
                postElement.className = 'post';

                const title = postData.title;
                const url = `https://www.reddit.com${postData.permalink}`;
                const thumbnail = postData.thumbnail && postData.thumbnail.startsWith('http') ? postData.thumbnail : 'https://www.redditinc.com/assets/images/site/reddit-logo.png';
                const timeSince = timeAgo(postData.created_utc);
                const comments = postData.num_comments;
                const mediaUrl = postData.url;
                const isImage = postData.post_hint === 'image';

                postElement.innerHTML = `
                    <div class="post-thumbnail">
                        <img src="${thumbnail}" alt="Thumbnail">
                    </div>
                    <div class="post-details">
                        <a href="${url}" target="_blank" class="post-title">${title}</a>
                        <div class="post-meta">
                            <span>${timeSince}</span> | 
                            <span class="comments-link" onclick="loadComments('${postData.id}', '${subreddit}')">${comments} comments</span>
                        </div>
                        ${isImage ? `<div class="expandable-image"><img src="${mediaUrl}" alt="Post Image"></div>` : ''}
                    </div>
                `;
                contentDiv.appendChild(postElement);
            });

            if (after) {
                document.getElementById('load-more').style.display = 'block';
            } else {
                document.getElementById('load-more').style.display = 'none';
            }
        }

        async function loadMorePosts() {
            loadSubreddit(currentSubreddit, false);
        }

        async function loadComments(postId, subreddit) {
            const response = await fetch(`https://www.reddit.com/r/${subreddit}/comments/${postId}.json?sort=best`);
            const data = await response.json();
            const comments = data[1].data.children;

            let commentsContainer = document.getElementById('comments-container');
            commentsContainer.innerHTML = '';
            
            comments.forEach(comment => {
                if (comment.kind !== 't1') return; // Ensure it's a comment

                const commentData = comment.data;
                const commentElement = document.createElement('div');
                commentElement.className = 'comment';

                const author = commentData.author;
                const body = commentData.body;
                const timeSince = timeAgo(commentData.created_utc);
                
                commentElement.innerHTML = `
                    <div class="comment-author">${author}</div>
                    <div class="comment-time">${timeSince}</div>
                    <div class="comment-body">${body}</div>
                `;
                commentsContainer.appendChild(commentElement);
            });

            document.getElementById('comments-modal').style.display = 'block';
        }

        function closeCommentsModal() {
            document.getElementById('comments-modal').style.display = 'none';
        }

        function timeAgo(utcSeconds) {
            const seconds = Math.floor(Date.now() / 1000) - utcSeconds;
            let interval = seconds / 31536000;

            if (interval > 1) {
                return Math.floor(interval) + " years ago";
            }
            interval = seconds / 2592000;
            if (interval > 1) {
                return Math.floor(interval) + " months ago";
            }
            interval = seconds / 86400;
            if (interval > 1) {
                return Math.floor(interval) + " days ago";
            }
            interval = seconds / 3600;
            if (interval > 1) {
                return Math.floor(interval) + " hours ago";
            }
            interval = seconds / 60;
            if (interval > 1) {
                return Math.floor(interval) + " minutes ago";
            }
            return Math.floor(seconds) + " seconds ago";
        }
    </script>
</body>
</html>
